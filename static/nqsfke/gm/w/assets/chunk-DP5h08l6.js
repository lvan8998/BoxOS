import{u as e,C as l,S as t,s as n,f as a,g as s,e as o,N as r,L as i,i as u}from"./ht-DIEl3wcJ.js";import{u as c}from"./chunk-ESEIOpnH.js";import{_ as d}from"./chunk-Py1EMREM.js";import{_ as p}from"./chunk-BhYrTiFM.js";import{b as m}from"./chunk-Cd8018WW.js";import{N as f}from"./chunk-DH8whQsn.js";import{C as v,D as h,P as x,X as y,u as k,E as w,J as g,$ as j,N as b,r as D,b as C,L as M,W as T,Q as _,G as S,V as z,Y as E,c as L,a as P,U as R,Z as G}from"./chunk-DPRUGDB1.js";import{_ as I}from"./chunk-DENGRH6q.js";import{a as N}from"./chunk-CMQyd8eO.js";import{D as U,r as V}from"./chunk-CyK2TLz7.js";import{k as B}from"./chunk-CNslwv-E.js";import{s as H,c as q}from"./chunk-B6RrTHmg.js";import"./chunk-DWTGLlOg.js";import"./chunk-a7obrEbD.js";import"./chunk-DQhVL27x.js";import"./chunk-cn7T4ICr.js";import"./chunk-Bh3yC0yB.js";import"./chunk-DjdYu-xF.js";/* empty css              */import"./chunk-BHPWSuhB.js";import"./chunk-Xpcu2h2O.js";import"./chunk-fUqY2CL3.js";import"./chunk-B9m9zD55.js";import"./chunk-rMGfDec6.js";import"./chunk-BJDOL0vG.js";const W={class:"flex w-full flex-col px-[15px]"},Z={class:"text-[18px] text-black font-bold"},A={class:"flex flex-row mt-1"},J={class:"text-[14px] text-gray-400"},K={class:"ml-5 text-[14px] text-gray-400"},Q=v({__name:"CGDetailHeaderView",setup(t){m();const n=c();return e(),(e,t)=>{var a,s,o,r;return w(),h("div",W,[x("span",Z,y(null==(a=k(n).artDetailModel)?void 0:a.artName),1),x("div",A,[x("p",J,"人气："+y(k(f).formatNumber(null!=(o=null==(s=k(n).artDetailModel)?void 0:s.artHits)?o:0)),1),x("p",K,"时间："+y(k(l).formatTimestamp(null==(r=k(n).artDetailModel)?void 0:r.artTime)),1)]),t[0]||(t[0]=x("div",{class:"h-[15px]"},null,-1))])}}}),X={class:"w-full px-[15px] mt-[15px]"},Y={class:"w-full flex flex-row items-center h-[45px] rounded-[5px] border-[1px]"},$=v({__name:"CGDetailSendDanMuView",setup(e){const l=c(),r=()=>{if(t.isEmpty(l.danMuText))return void n("请输入弹幕内容");const e=Date.now(),r=a.get(s.lastSendDanmuTime);r&&e-r<=6e4?n("刚发布过了，请喝杯咖啡休息一会~"):(o.emit("sendDanMu",l.danMuText),document.activeElement.blur())};return(e,t)=>(w(),h("div",X,[x("div",Y,[g(x("input",{type:"text",placeholder:"输入弹幕，Enter发送","onUpdate:modelValue":t[0]||(t[0]=e=>k(l).danMuText=e),onKeyup:b(r,["enter"]),enterkeyhint:"send",maxlength:"50",class:"bg-transparent grow pl-3 py-3 placeholder-gray-400 focus:outline-none text-[14px] text-black"},null,544),[[j,k(l).danMuText]]),x("button",{class:"h-full bg-blue-900 w-[75px] rounded-r-[5px] flex items-center justify-center",onClick:r},t[1]||(t[1]=[x("i",{class:"iconfont icon-send text-white",style:{"font-size":"20px"}},null,-1)]))])]))}}),F={class:"w-full px-[15px] mt-[15px]"},O={class:"w-full height-w-4-3 relative"},ee={class:"w-full h-full bg-white/10 z-10 absolute left-0 top-0 pointer-events-none"},le={key:0,class:"absolute lef-0 top-0 w-full h-full z-10 bg-black flex items-center justify-center pointer-events-none"},te={key:2,class:"absolute lef-0 top-0 w-full h-full flex items-center justify-center z-10 transform",style:{"pointer-events":"none"}},ne=v({__name:"CGDPlayerView",props:{id:{},url:{},cover:{}},setup(e,{expose:l}){const n=e,a=D(!0),s=D(!1),o=D(!1);let u=null;const c=D(),d=D(!0),p=D();let m=0,f=[];function v(){d.value=!d.value,d.value?c.value.show():c.value.hide()}C(()=>{t.isEmpty(n.url)||(u=U.initPlayer("cgdplayerId",n.url),g(),u&&(u.on("loadedmetadata",()=>{s.value=!0}),u.on("canplay",()=>{s.value=!0}),u.on("play",()=>{u.video.muted=!1,o.value=!0,c.value.play()}),u.on("pause",()=>{c.value.pause()}),u.on("timeupdate",()=>{!function(e){for(let l=m;l<f.length;l++)if(f[l].time<=e){c.value.insert(f[l]),m=l+1;break}}((null==u?void 0:u.video.currentTime)||0)}),u.on("seeked",()=>{c.value.stop(),c.value.play(),m=function(e){for(let l=0;l<f.length;l++)if(f[l].time>=e)return l;return f.length}((null==u?void 0:u.video.currentTime)||0)}),u.on("error",e=>{var l,a,o,r;s.value=!0;const i=(null!=(l=null==u?void 0:u.video.error.message)?l:"no msg").toLowerCase();if(t.isEmpty(i.trim())||i.includes("empty src"))return;let c={url:n.url,time:null!=(a=null==u?void 0:u.video.currentTime)?a:0,code:null!=(r=null==(o=null==u?void 0:u.video.error)?void 0:o.code)?r:-1,msg:i};V(c)})))});const g=()=>{const e=document.querySelector(".dplayer-setting");if(e&&p.value){const l=p.value.firstElementChild;l&&e.insertBefore(l,e.firstChild)}},j=()=>{a.value=!1,u.play()};return l({updateDanmuList:function(e){f=e,m=0},sendDanmu:function(e){c.value.insert({content:e.content,color:e.color,isSelf:!0})},destroyPlayer:()=>{u&&u.destroy()},getPlayTime:function(){var e;return null!=(e=null==u?void 0:u.video.currentTime)?e:0}}),(e,l)=>{var t;return w(),h(M,null,[x("div",F,[x("div",O,[l[1]||(l[1]=x("div",{id:"cgdplayerId",class:_(["w-full h-full"])},null,-1)),x("div",ee,[S(k(B),{ref_key:"danmakuRef",ref:c,speeds:60},{danmu:z(({index:e,danmu:l})=>[x("span",{class:_(["text-[14px] px-1 py-[1px]",l.isSelf?"border":""]),style:E({color:"".concat(l.color),borderColor:"".concat(l.color)})},y(l.content),7)]),_:1},512)]),a.value?(w(),h("div",le,[S(r,{src:null!=(t=n.cover)?t:"",class:"w-full h-full object-contain"},null,8,["src"])])):T("",!0),a.value&&s.value?(w(),h("div",{key:1,class:"absolute lef-0 top-0 w-full h-full shrink-0 bg-black/30 flex items-center justify-center z-10 transform",onClick:j},l[0]||(l[0]=[x("i",{class:"iconfont icon-playcircle text-white",style:{"font-size":"50px"}},null,-1)]))):T("",!0),s.value?T("",!0):(w(),h("div",te,[S(i,{size:40})]))])]),x("div",{ref_key:"danmuIconRef",ref:p,style:{display:"none"}},[x("div",{class:"dplayer-icon flex items-center justify-center",onClick:v},[x("i",{class:_([["iconfont text-[#CCCCCC]",d.value?"icon-danmu-open":"icon-danmu-close"],""]),style:{"font-size":"22px"}},null,2)])],512)],64)}}}),ae={class:"w-full"},se={key:0},oe={class:"w-full px-[15px] mt-[5px]"},re={class:"w-full bg-white rounded-[4px] flex flex-col py-[10px] items-center border"},ie=["innerHTML"],ue=v({__name:"index",props:{id:{}},setup(r){const i=r,m=c();e();const f=D();return L(async()=>{let e=i.id;o.on("sendDanMu",e=>{!async function(e){var t,o,r;if(m.isSending)return;const i=null!=(o=null==(t=f.value)?void 0:t.getPlayTime())?o:0;H({duration:0,message:"正在发送",forbidClick:!1});const c=await m.reqSendDanMu(e,i);q(),u(c.code)?(null==(r=f.value)||r.sendDanmu({content:e,time:i,color:l.getRandomBrightColor(),isSelf:!0}),m.clearDanMuInput(),n("发送成功"),a.set(s.lastSendDanmuTime,Date.now())):n("".concat(c.msg))}(e)}),m.resetChiGuaDetail(),t.isEmpty(e)||m.setArtId(e),await m.reqChiDetail(),null!=m.artDetailModel&&m.isShowBarrage&&async function(e){var t;try{const n=window.location.protocol,a="".concat(n,"//").concat(window.location.host,"/json").concat(new URL(e).pathname),s=(await N.get(a)).data,o=[];for(let e of s)o.push({content:e.barrageMsg,time:e.duration,color:l.getRandomBrightColor(),isSelf:!1});null==(t=f.value)||t.updateDanmuList(o)}catch(n){}}(m.artDetailModel.barrageUrl)}),P(()=>{var e;o.off("sendDanMu"),null==(e=null==f?void 0:f.value)||e.destroyPlayer()}),(e,l)=>{var t,n;return w(),h("div",ae,[null!=k(m).artDetailModel?(w(),h("div",se,[x("div",oe,[x("div",re,[S(Q),(w(!0),h(M,null,G(k(m).artContentStrs,(e,l)=>(w(),h("div",{class:"w-full px-[15px]",key:l},[e.startsWith("http")?(w(),R(I,{key:0,url:e,class:"w-full","img-height":350,rounded:0},null,8,["url"])):(w(),h("div",{key:1,innerHTML:e},null,8,ie))]))),128))])]),S(ne,{ref_key:"playerRef",ref:f,id:i.id,url:null!=(n=null==(t=k(m).artDetailModel)?void 0:t.playUrl)?n:"",cover:k(m).artDetailModel.artPic},null,8,["id","url","cover"]),S($)])):T("",!0),null==k(m).artDetailModel?(w(),R(d,{key:1})):T("",!0),l[0]||(l[0]=x("div",{class:"h-[100px] shrink-0"},null,-1)),S(p)])}}});export{ue as default};
